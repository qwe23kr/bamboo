<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ff69b4">
    <meta name="description" content="Î∞§Î∂Ä - ÎåÄÎÇòÎ¨¥Ïà≤ Ïª§ÎÆ§ÎãàÌã∞">
    <title>Î∞§Î∂Ä - Î©îÏù∏</title>
    <link rel="manifest" href="/bamboo/manifest.json">
    <link rel="apple-touch-icon" href="/bamboo/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Yanolja';
            src: url('https://gcore.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/YanoljaYacheR.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Yanolja', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #ffb6c1 0%, #ffc0cb 50%, #ffd1dc 100%);
            min-height: 100vh;
            padding: 10px;
            position: relative;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Î∞∞Í≤Ω Ïû•Ïãù */
        body::before {
            content: '‚ú®';
            position: fixed;
            font-size: 2em;
            color: rgba(255, 255, 255, 0.3);
            top: 10%;
            left: 10%;
            animation: float 3s ease-in-out infinite;
        }
        
        body::after {
            content: 'üíñ';
            position: fixed;
            font-size: 1.5em;
            color: rgba(255, 255, 255, 0.3);
            top: 20%;
            right: 15%;
            animation: float 4s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        /* Î≥ÑÍ∞ÄÎ£® Ìö®Í≥º */
        .sparkle {
            position: fixed;
            pointer-events: none;
            font-size: 1.5em;
            z-index: 9999;
            animation: sparkleFall 1.5s ease-out forwards;
            user-select: none;
        }
        
        @keyframes sparkleFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(100px) rotate(360deg) scale(0.3);
            }
        }
        
        .sparkle-emoji {
            display: inline-block;
            animation: sparkleRotate 1.5s linear infinite;
        }
        
        @keyframes sparkleRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 18px 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(255, 182, 193, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
            gap: 15px;
        }
        
        .logo {
            font-family: 'Yanolja', sans-serif;
            font-size: 2.2em;
            color: #ff69b4;
            font-weight: normal;
            word-break: keep-all;
            letter-spacing: 0.5px;
            white-space: nowrap;
            flex-shrink: 0;
        }  
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: nowrap;
            flex-shrink: 0;
        }
        
        .user-name {
            color: #ff69b4;
            font-weight: 500;
            font-size: 0.95em;
        }
        
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 20px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Yanolja', sans-serif;
            min-height: 40px;
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn-pink {
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(255, 105, 180, 0.3);
        }
        
        .btn-pink:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 105, 180, 0.4);
        }
        
        .btn-logout {
            background: transparent;
            color: #999;
            border: none;
            font-weight: 400;
            font-size: 0.9em;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Yanolja', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn-logout:hover {
            color: #666;
        }
        
        /* ÌÉ≠ Î©îÎâ¥ */
        .tabs-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(255, 182, 193, 0.5);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            justify-content: space-around;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            background: transparent;
            color: #999;
            font-family: 'Yanolja', sans-serif;
            font-size: 1em;
            font-weight: normal;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(255, 105, 180, 0.3);
        }
        
        .tab-btn:hover:not(.active) {
            background: #f5f5f5;
            color: #ff69b4;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ÎØ∏ÎîîÏñ¥ ÏóÖÎ°úÎìú */
        .media-upload-area {
            margin-bottom: 15px;
        }
        
        .upload-btn {
            display: inline-block;
            padding: 15px 25px;
            background: linear-gradient(135deg, #ffc0cb 0%, #ffb6c1 100%);
            color: #ff69b4;
            border-radius: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-family: 'Yanolja', sans-serif;
            font-weight: normal;
            border: 2px dashed #ff69b4;
        }
        
        .upload-btn:hover {
            background: linear-gradient(135deg, #ffb6c1 0%, #ffc0cb 100%);
            transform: translateY(-2px);
        }
        
        .media-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .media-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            aspect-ratio: 1;
        }
        
        .media-item img,
        .media-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .media-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .post-media {
            margin: 15px 0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .post-media img,
        .post-media video {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .post-media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .post-media-grid img,
        .post-media-grid video {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .write-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(255, 182, 193, 0.5);
        }
        
        .write-title {
            font-family: 'Yanolja', sans-serif;
            font-size: 1.6em;
            color: #ff69b4;
            margin-bottom: 15px;
            font-weight: normal;
        }
        
        .write-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ffc0cb;
            border-radius: 15px;
            font-size: 16px; /* Î™®Î∞îÏùºÏóêÏÑú ÏûêÎèô Ï§å Î∞©ÏßÄ */
            font-family: 'Yanolja', sans-serif;
            resize: vertical;
            min-height: 100px;
            transition: all 0.3s;
            -webkit-appearance: none;
            font-weight: 400;
        }
        
        textarea:focus {
            outline: none;
            border-color: #ff69b4;
            box-shadow: 0 0 10px rgba(255, 105, 180, 0.3);
        }
        
        .posts-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .post {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(255, 182, 193, 0.5);
            animation: slideIn 0.5s ease-out;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ffc0cb;
            position: relative;
        }
        
        .post-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .delete-btn {
            background: transparent;
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Yanolja', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        .delete-btn:hover {
            background: #ff6b6b;
            color: white;
        }
        
        .edit-btn {
            background: transparent;
            border: 1px solid #ff69b4;
            color: #ff69b4;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Yanolja', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        .edit-btn:hover {
            background: #ff69b4;
            color: white;
        }
        
        .post-author {
            font-weight: 600;
            color: #ff69b4;
            font-size: 1.05em;
        }
        
        .post-date {
            color: #999;
            font-size: 0.9em;
            font-weight: 400;
        }
        
        .post-content {
            color: #333;
            line-height: 1.8;
            margin-bottom: 20px;
            font-size: 1.05em;
            font-weight: 400;
        }
        
        .comments-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ffc0cb;
        }
        
        .comment-form {
            position: relative;
            margin-bottom: 15px;
        }
        
        .comment-input {
            width: 100%;
            padding: 12px 50px 12px 15px;
            border: 2px solid #ffc0cb;
            border-radius: 20px;
            font-family: 'Yanolja', sans-serif;
            font-size: 16px; /* Î™®Î∞îÏùºÏóêÏÑú ÏûêÎèô Ï§å Î∞©ÏßÄ */
            min-height: 44px;
            -webkit-appearance: none;
            font-weight: 400;
            box-sizing: border-box;
        }
        
        .comment-input:focus {
            outline: none;
            border-color: #ff69b4;
        }
        
        .comment-submit-inline {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            color: white;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(255, 105, 180, 0.3);
        }
        
        .comment-submit-inline::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 8px solid white;
            transform: rotate(-45deg) translateX(-2px);
            transition: all 0.2s;
        }
        
        .comment-submit-inline::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 8px solid white;
            transform: rotate(45deg) translateX(2px);
            transition: all 0.2s;
        }
        
        .comment-submit-inline:hover {
            background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%);
            box-shadow: 0 3px 8px rgba(255, 105, 180, 0.4);
            transform: translateY(-50%) scale(1.05);
        }
        
        .comment-submit-inline:hover::before,
        .comment-submit-inline:hover::after {
            transform: rotate(-45deg) translateX(-2px) scale(1.1);
        }
        
        .comment-submit-inline:hover::after {
            transform: rotate(45deg) translateX(2px) scale(1.1);
        }
        
        .comment-submit-inline:active {
            transform: translateY(-50%) scale(0.95);
        }
        
        .comment-submit-inline:active::before {
            transform: rotate(-45deg) translateX(-2px) scale(0.9);
        }
        
        .comment-submit-inline:active::after {
            transform: rotate(45deg) translateX(2px) scale(0.9);
        }
        
        .comment {
            background: #fff5f5;
            padding: 12px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #ff69b4;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0;
        }
        
        .comment-author {
            font-weight: 600;
            color: #ff69b4;
            font-size: 0.95em;
        }
        
        .comment-date {
            color: #999;
            font-size: 0.85em;
            font-weight: 400;
        }
        
        .comment-content {
            color: #555;
            font-size: 0.95em;
            font-weight: 400;
            display: inline;
        }
        
        .comment-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        
        .comment-text-left {
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
        }
        
        .comment-delete-btn {
            background: transparent;
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Yanolja', sans-serif;
            -webkit-tap-highlight-color: transparent;
            margin-left: 8px;
        }
        
        .comment-delete-btn:hover {
            background: #ff6b6b;
            color: white;
        }
        
        .loading {
            text-align: center;
            color: #ff69b4;
            padding: 50px;
            font-size: 1.1em;
            font-weight: 400;
        }
        
        /* Îã¨Î†• Ïä§ÌÉÄÏùº */
        .calendar-container {
            background: white;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(255, 182, 193, 0.3);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-title {
            font-family: 'Yanolja', sans-serif;
            font-size: 1.5em;
            color: #ff69b4;
            font-weight: normal;
            margin: 0;
        }
        
        .calendar-nav-btn {
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Yanolja', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        .calendar-nav-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(255, 105, 180, 0.4);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            color: #ff69b4;
            padding: 6px;
            font-family: 'Yanolja', sans-serif;
            font-size: 0.85em;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            background: #fff5f5;
            border: 1.5px solid #ffc0cb;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Yanolja', sans-serif;
            position: relative;
            min-height: 0;
        }
        
        .calendar-day:hover {
            background: #ffe4e9;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(255, 105, 180, 0.3);
        }
        
        .calendar-day.other-month {
            opacity: 0.2;
        }
        
        .calendar-day.today {
            background: linear-gradient(135deg, #ffc0cb 0%, #ffb6c1 100%);
            border-color: #ff69b4;
            font-weight: 600;
        }
        
        .calendar-day-number {
            font-size: 0.85em;
            color: #333;
            margin-bottom: 2px;
            font-weight: 500;
        }
        
        .calendar-day-events {
            display: flex;
            flex-direction: column;
            gap: 1px;
            width: 100%;
            margin-top: 2px;
        }
        
        .calendar-event {
            font-size: 0.6em;
            padding: 1px 3px;
            border-radius: 3px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
        }
        
        .calendar-event.birthday {
            background: #ff69b4;
            color: white;
        }
        
        .calendar-event.dday {
            background: #ffc0cb;
            color: #ff1493;
        }
        
        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding-top: 10px;
            border-top: 1px solid #ffc0cb;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'Yanolja', sans-serif;
            font-size: 0.8em;
            color: #666;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        
        .calendar-events-list {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #ffc0cb;
        }
        
        .events-list-title {
            font-family: 'Yanolja', sans-serif;
            font-size: 1.3em;
            color: #ff69b4;
            margin-bottom: 15px;
            font-weight: normal;
        }
        
        .event-item {
            background: #fff5f5;
            border: 1px solid #ffc0cb;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            font-family: 'Yanolja', sans-serif;
        }
        
        .event-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .event-date {
            color: #ff69b4;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .event-delete-btn {
            background: transparent;
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Yanolja', sans-serif;
        }
        
        .event-delete-btn:hover {
            background: #ff6b6b;
            color: white;
        }
        
        .event-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .event-description {
            color: #666;
            font-size: 0.9em;
        }
        
        .calendar-event.schedule {
            width: 6px;
            height: 6px;
            background: #90EE90;
            border-radius: 50%;
            margin: 0 auto;
            padding: 0;
            text-indent: -9999px;
            overflow: hidden;
        }
        
        /* Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        .modal-title {
            font-family: 'Yanolja', sans-serif;
            font-size: 1.8em;
            color: #ff69b4;
            margin-bottom: 20px;
            font-weight: normal;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s;
            line-height: 1;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            color: #ff69b4;
            transform: rotate(90deg);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        /* ÌîåÎ°úÌåÖ + Î≤ÑÌäº */
        .floating-add-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff69b4 0%, #ff1493 100%);
            color: white;
            border: none;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 105, 180, 0.5);
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Yanolja', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        .floating-add-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 25px rgba(255, 105, 180, 0.7);
        }
        
        .floating-add-btn:active {
            transform: scale(0.95);
        }
        
        /* ÌîåÎ°úÌåÖ Î≤ÑÌäºÏùÄ JavaScriptÎ°ú Ï†úÏñ¥ */
        
        .pending-user {
            background: #fff5f5;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-details {
            flex: 1;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ffc0cb;
            border-radius: 10px;
            font-size: 1em;
            font-family: 'Yanolja', sans-serif;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #ff69b4;
        }
        
        .user-details strong {
            color: #ff69b4;
        }
        
        /* Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
        @media (max-width: 768px) {
            body {
                padding: 10px 5px;
            }
            
            .header {
                flex-direction: row;
                text-align: left;
                padding: 15px;
                gap: 10px;
            }
            
            .logo {
                font-size: 1.5em;
                line-height: 1.2;
            }
            
            .user-info {
                width: auto;
                justify-content: flex-end;
                flex-direction: row;
                align-items: center;
            }
            
            .btn {
                width: auto;
                font-size: 0.9em;
                padding: 10px 16px;
            }
            
            .btn-logout {
                font-size: 0.85em;
                padding: 6px 10px;
            }
            
            .write-section {
                padding: 15px;
            }
            
            .write-title {
                font-size: 1.5em;
            }
            
            .post {
                padding: 15px;
            }
            
            .post-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .post-author {
                font-size: 1em;
            }
            
            .post-date {
                font-size: 0.85em;
            }
            
            .post-content {
                font-size: 1em;
                line-height: 1.6;
            }
            
            .comment-form {
                position: relative;
            }
            
            .comment-input {
                width: 100%;
                padding-right: 50px;
            }
            
            .comment-submit-inline {
                right: 5px;
                font-size: 1.3em;
            }
            
            .comment {
                padding: 10px 12px;
            }
            
            .comment-text {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .comment-date {
                align-self: flex-end;
            }
            
            .modal-content {
                padding: 20px;
                margin: 10px;
            }
            
            .modal-title {
                font-size: 1.5em;
            }
            
            .pending-user {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .pending-user .btn {
                width: 100%;
            }
            
            .tabs {
                gap: 5px;
            }
            
            .tab-btn {
                padding: 10px 12px;
                font-size: 0.9em;
            }
            
            .media-preview {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .post-media-grid {
                grid-template-columns: 1fr;
            }
            
            .floating-add-btn {
                width: 55px;
                height: 55px;
                font-size: 1.8em;
                bottom: 20px;
                right: 20px;
            }
            
            .calendar-container {
                padding: 12px;
            }
            
            .calendar-title {
                font-size: 1.3em;
            }
            
            .calendar-nav-btn {
                width: 30px;
                height: 30px;
                font-size: 0.9em;
            }
            
            .calendar-grid {
                gap: 3px;
            }
            
            .calendar-day-header {
                padding: 4px;
                font-size: 0.75em;
            }
            
            .calendar-day {
                padding: 3px;
                border-width: 1px;
            }
            
            .calendar-day-number {
                font-size: 0.75em;
            }
            
            .calendar-event {
                font-size: 0.5em;
                padding: 1px 2px;
            }
        }
        
        @media (max-width: 480px) {
            .logo {
                font-size: 1.3em;
            }
            
            .header {
                padding: 12px 15px;
                gap: 8px;
            }
            
            .user-info {
                gap: 8px;
            }
            
            .user-name {
                font-size: 0.85em;
            }
            
            .write-title {
                font-size: 1.3em;
            }
            
            .post-content {
                font-size: 0.95em;
            }
            
            body::before,
            body::after {
                display: none; /* ÏûëÏùÄ ÌôîÎ©¥ÏóêÏÑúÎäî Î∞∞Í≤Ω Ïû•Ïãù Ïà®ÍπÄ */
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">‚ú® Î∞§Î∂Ä ‚ú® - ÎåÄÎÇòÎ¨¥Ïà≤</div>
        <div class="user-info">
            <span class="user-name" id="userName">Î°úÎî© Ï§ë...</span>
            <button id="approveBtn" class="btn btn-pink" onclick="openUserManagementModal()" style="display: none;">ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</button>
            <button class="btn-logout" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
        </div>
    </div>
    
    <!-- ÌÉ≠ Î©îÎâ¥ -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="praise" onclick="switchTab('praise')">Ïπ≠Ï∞¨ÌïòÍ∏∞</button>
            <button class="tab-btn" data-tab="complaint" onclick="switchTab('complaint')">ÎØºÏõêÏ†úÍ∏∞</button>
            <button class="tab-btn" data-tab="daily" onclick="switchTab('daily')">ÏùºÏÉÅÎ°úÍ∑∏</button>
            <button class="tab-btn" data-tab="calendar" onclick="switchTab('calendar')">ÏùºÏ†ïÍ≥µÏú†</button>
        </div>
    </div>
    
    <!-- Ïπ≠Ï∞¨ÌïòÍ∏∞ ÌÉ≠ -->
    <div id="praiseTab" class="tab-content active">
        <div class="posts-container" id="praisePosts"></div>
    </div>
    
    <!-- ÎØºÏõêÏ†úÍ∏∞ ÌÉ≠ -->
    <div id="complaintTab" class="tab-content">
        <div class="posts-container" id="complaintPosts"></div>
    </div>
    
    <!-- ÏùºÏÉÅÎ°úÍ∑∏ ÌÉ≠ -->
    <div id="dailyTab" class="tab-content">
        <div class="posts-container" id="dailyPosts"></div>
    </div>
    
    <!-- Îã¨Î†• ÌÉ≠ -->
    <div id="calendarTab" class="tab-content">
        <div class="calendar-container">
            <div class="calendar-header">
                <button class="calendar-nav-btn" onclick="changeMonth(-1)">‚óÄ</button>
                <h2 class="calendar-title" id="calendarTitle">2026ÎÖÑ 2Ïõî</h2>
                <button class="calendar-nav-btn" onclick="changeMonth(1)">‚ñ∂</button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
            <div class="calendar-legend">
                <div class="legend-item">
                    <span class="legend-color" style="background: #ff69b4;"></span>
                    <span>ÏÉùÏùº</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #ffc0cb;"></span>
                    <span>D+Ïù¥Î≤§Ìä∏</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #90EE90;"></span>
                    <span>ÏùºÏ†ï</span>
                </div>
            </div>
            <div class="calendar-events-list" id="calendarEventsList">
                <h3 class="events-list-title">üìÖ ÏùºÏ†ï Î™©Î°ù</h3>
                <div id="eventsListContainer"></div>
            </div>
        </div>
    </div>
    
    <!-- ÏùºÏ†ï Ï∂îÍ∞Ä Î™®Îã¨ -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="eventModalTitle">ÏùºÏ†ï Ï∂îÍ∞Ä</h2>
                <button class="close-btn" onclick="closeEventModal()">&times;</button>
            </div>
            <form id="eventForm" class="write-form">
                <input type="hidden" id="eventDate" value="">
                <input type="text" id="eventTitle" placeholder="ÏùºÏ†ï Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." required>
                <textarea id="eventDescription" placeholder="ÏùºÏ†ï ÏÑ§Î™Ö (ÏÑ†ÌÉùÏÇ¨Ìï≠)" rows="3"></textarea>
                <button type="submit" class="btn btn-pink">ÏùºÏ†ï Ï∂îÍ∞Ä</button>
            </form>
        </div>
    </div>
    
    <!-- ÌîåÎ°úÌåÖ + Î≤ÑÌäº -->
    <button id="floatingAddBtn" class="floating-add-btn" onclick="openWriteModal()">+</button>
    
    <!-- Í∏Ä ÏûëÏÑ± Î™®Îã¨ -->
    <div id="writeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="writeModalTitle">üíï Ïπ≠Ï∞¨ÌïòÍ∏∞</h2>
                <button class="close-btn" onclick="closeWriteModal()">&times;</button>
            </div>
            
            <form id="writeForm" class="write-form">
                <input type="hidden" id="editPostId" value="">
                <input type="hidden" id="editTabName" value="">
                
                <textarea id="writeContent" placeholder="ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî üí≠" rows="6" required></textarea>
                
                <!-- ÏùºÏÉÅÎ°úÍ∑∏Ïùº ÎïåÎßå ÎØ∏ÎîîÏñ¥ ÏóÖÎ°úÎìú ÌëúÏãú -->
                <div id="mediaUploadSection" class="media-upload-area" style="display: none;">
                    <input type="file" id="mediaInput" accept="image/*,video/*" multiple style="display: none;" onchange="handleMediaSelect(event)">
                    <label for="mediaInput" class="upload-btn">
                        <span>üì∑ ÏÇ¨ÏßÑ/ÏòÅÏÉÅ Ï∂îÍ∞Ä</span>
                    </label>
                    <div id="mediaPreview" class="media-preview"></div>
                </div>
                
                <button type="submit" class="btn btn-pink" id="writeSubmitBtn">ÏûëÏÑ±ÌïòÍ∏∞</button>
            </form>
        </div>
    </div>
    
    <!-- Í¥ÄÎ¶¨Ïûê ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ Î™®Îã¨ -->
    <div id="approveModal" class="modal">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <h2 class="modal-title">ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h2>
            <div style="margin-bottom: 15px;">
                <button class="btn btn-pink" onclick="showPendingUsers()" style="margin-right: 10px;">ÏäπÏù∏ ÎåÄÍ∏∞</button>
                <button class="btn btn-pink" onclick="showAllUsers()">Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê</button>
            </div>
            <div id="pendingUsers"></div>
        </div>
    </div>
    
    <!-- ÏÇ¨Ïö©Ïûê ÏàòÏ†ï Î™®Îã¨ -->
    <div id="editUserModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <h2 class="modal-title">ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏàòÏ†ï</h2>
            <form id="editUserForm" onsubmit="saveUserEdit(event)">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label>Ïù¥Î¶Ñ</label>
                    <input type="text" id="editUserName" required>
                </div>
                <div class="form-group">
                    <label>ÏÉùÎÖÑÏõîÏùº</label>
                    <input type="date" id="editUserBirthdate">
                </div>
                <div class="form-group">
                    <label>Ìï∏ÎìúÌè∞ Î≤àÌò∏</label>
                    <input type="tel" id="editUserPhone" placeholder="010-1234-5678">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-pink" style="flex: 1;">Ï†ÄÏû•</button>
                    <button type="button" class="btn" onclick="closeEditUserModal()" style="flex: 1; background: #ccc;">Ï∑®ÏÜå</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getDatabase, 
            ref, 
            get,
            set,
            update,
            push,
            onValue,
            remove
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import {
            getStorage,
            ref as storageRef,
            uploadBytes,
            getDownloadURL,
            deleteObject
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        
        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: "AIzaSyCx92CLNVBaHLKNxaaY5Ydnrm8HksNapnw",
            authDomain: "bamboo-5008c.firebaseapp.com",
            databaseURL: "https://bamboo-5008c-default-rtdb.firebaseio.com",
            projectId: "bamboo-5008c",
            storageBucket: "bamboo-5008c.firebasestorage.app",
            messagingSenderId: "51130215561",
            appId: "1:51130215561:web:8f8922b2b0b95852946a58",
            measurementId: "G-WFSV2Q6B3D"
        };
        
        // Firebase Ï¥àÍ∏∞Ìôî
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const storage = getStorage(app);
        
        // Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú ÏÑ§Ï†ï
        window.firebaseDatabase = database;
        window.firebaseStorage = storage;
        window.firebaseRef = ref;
        window.firebaseGet = get;
        window.firebaseSet = set;
        window.firebasePush = push;
        window.firebaseOnValue = onValue;
        window.firebaseRemove = remove;
        window.storageRef = storageRef;
        window.uploadBytes = uploadBytes;
        window.getDownloadURL = getDownloadURL;
        window.deleteObject = deleteObject;
        
        // ÌòÑÏû¨ ÌÉ≠
        window.currentTab = 'praise';
        
        // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î°úÎìú
        function loadUserInfo() {
            const userId = localStorage.getItem('bamboo_userId');
            const userName = localStorage.getItem('bamboo_userName');
            const isAdmin = localStorage.getItem('bamboo_isAdmin') === 'true';
            
            if (!userId) {
                window.location.href = 'login.html';
                return;
            }
            
            document.getElementById('userName').textContent = userName + 'Îãò';
            
            if (isAdmin) {
                document.getElementById('approveBtn').style.display = 'block';
            }
            
            // ÌÉ≠Î≥Ñ Í∏Ä Î™©Î°ù Î°úÎìú
            loadTabPosts('praise');
            
            // ÌîåÎ°úÌåÖ Î≤ÑÌäº ÌëúÏãú
            const floatingBtn = document.getElementById('floatingAddBtn');
            floatingBtn.style.display = 'flex';
        }
        
        // ÌÉ≠ Ï†ÑÌôò
        window.switchTab = function(tabName) {
            window.currentTab = tabName;
            
            // ÌÉ≠ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // ÌÉ≠ Ïª®ÌÖêÏ∏† ÌëúÏãú
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            // ÌîåÎ°úÌåÖ + Î≤ÑÌäº (Îã¨Î†• ÌÉ≠ÏóêÏÑúÎäî Ïà®ÍπÄ)
            const floatingBtn = document.getElementById('floatingAddBtn');
            if (tabName === 'calendar') {
                floatingBtn.style.display = 'none';
            } else {
                floatingBtn.style.display = 'flex';
            }
            
            // Ìï¥Îãπ ÌÉ≠Ïùò Ïª®ÌÖêÏ∏† Î°úÎìú
            if (tabName === 'calendar') {
                renderCalendar();
            } else {
                loadTabPosts(tabName);
            }
        };
        
        // Îã¨Î†• Í¥ÄÎ†® Î≥ÄÏàò
        let currentCalendarDate = new Date(2026, 1, 7); // 2026ÎÖÑ 2Ïõî 7Ïùº (D+1 Í∏∞Ï§ÄÏùº)
        const dDayBase = new Date(2026, 1, 7); // 2026ÎÖÑ 2Ïõî 7Ïùº
        
        // Îã¨Î†• Î†åÎçîÎßÅ
        async function renderCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            calendarTitle.textContent = `${year}ÎÖÑ ${month + 1}Ïõî`;
            
            // ÏÇ¨Ïö©Ïûê ÏÉùÎÖÑÏõîÏùº Í∞ÄÏ†∏Ïò§Í∏∞
            const usersRef = ref(database, 'users');
            const usersSnapshot = await get(usersRef);
            const birthdays = {};
            
            if (usersSnapshot.exists()) {
                const users = usersSnapshot.val();
                Object.values(users).forEach(user => {
                    if (user.birthdate && user.approved) {
                        const birthDate = new Date(user.birthdate);
                        const monthKey = `${birthDate.getMonth()}-${birthDate.getDate()}`;
                        if (!birthdays[monthKey]) {
                            birthdays[monthKey] = [];
                        }
                        birthdays[monthKey].push({
                            name: user.name,
                            year: birthDate.getFullYear()
                        });
                    }
                });
            }
            
            // ÏùºÏ†ï Í∞ÄÏ†∏Ïò§Í∏∞
            const eventsRef = ref(database, 'events');
            const eventsSnapshot = await get(eventsRef);
            const events = {};
            
            if (eventsSnapshot.exists()) {
                const eventsData = eventsSnapshot.val();
                Object.entries(eventsData).forEach(([eventId, event]) => {
                    const eventDate = new Date(event.date);
                    const dateKey = `${eventDate.getFullYear()}-${eventDate.getMonth()}-${eventDate.getDate()}`;
                    if (!events[dateKey]) {
                        events[dateKey] = [];
                    }
                    events[dateKey].push({
                        id: eventId,
                        title: event.title,
                        description: event.description,
                        author: event.author
                    });
                });
            }
            
            // Îã¨Î†• Í∑∏Î¶¨Îìú Ï¥àÍ∏∞Ìôî
            calendarGrid.innerHTML = '';
            
            // ÏöîÏùº Ìó§Îçî
            const dayHeaders = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });
            
            // Ï≤´ ÎÇ†Í≥º ÎßàÏßÄÎßâ ÎÇ† Í≥ÑÏÇ∞
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - startDate.getDay());
            
            // Îã¨Î†• ÎÇ†Ïßú ÏÉùÏÑ± (ÌïÑÏöîÌïú Ï£º ÏàòÎßå Í≥ÑÏÇ∞)
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // ÎßàÏßÄÎßâ ÎÇ†Ïßú Í≥ÑÏÇ∞
            const endDate = new Date(lastDay);
            endDate.setDate(endDate.getDate() + (6 - endDate.getDay()));
            
            // ÌïÑÏöîÌïú ÎÇ†Ïßú Ïàò Í≥ÑÏÇ∞
            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            
            for (let i = 0; i < totalDays; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                const isCurrentMonth = currentDate.getMonth() === month;
                const isToday = currentDate.getTime() === today.getTime();
                
                if (!isCurrentMonth) {
                    dayDiv.classList.add('other-month');
                }
                if (isToday) {
                    dayDiv.classList.add('today');
                }
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'calendar-day-number';
                dayNumber.textContent = currentDate.getDate();
                dayDiv.appendChild(dayNumber);
                
                const eventsDiv = document.createElement('div');
                eventsDiv.className = 'calendar-day-events';
                
                // ÏÉùÏùº Ï≤¥ÌÅ¨
                const monthKey = `${currentDate.getMonth()}-${currentDate.getDate()}`;
                if (birthdays[monthKey]) {
                    birthdays[monthKey].forEach(birthday => {
                        const event = document.createElement('div');
                        event.className = 'calendar-event birthday';
                        event.textContent = `üéÇ ${birthday.name}`;
                        event.title = `${birthday.name} ÏÉùÏùº`;
                        eventsDiv.appendChild(event);
                    });
                }
                
                // D+Ïù¥Î≤§Ìä∏ Ï≤¥ÌÅ¨ (2026ÎÖÑ 2Ïõî 7Ïùº Í∏∞Ï§Ä)
                if (isCurrentMonth) {
                    const daysDiff = Math.floor((currentDate - dDayBase) / (1000 * 60 * 60 * 24));
                    if (daysDiff >= 0) {
                        const years = Math.floor(daysDiff / 365);
                        if (years > 0 && daysDiff % 365 === 0) {
                            const event = document.createElement('div');
                            event.className = 'calendar-event dday';
                            event.textContent = `D+${daysDiff} (${years}ÎÖÑ)`;
                            event.title = `D+${daysDiff} (${years}ÎÖÑ)`;
                            eventsDiv.appendChild(event);
                        } else if (daysDiff > 0 && daysDiff % 365 !== 0) {
                            // 1ÎÖÑ ÎØ∏ÎßåÏù¥ÏßÄÎßå ÌäπÏ†ï ÎÇ†Ïßú Ï≤¥ÌÅ¨
                            const event = document.createElement('div');
                            event.className = 'calendar-event dday';
                            event.textContent = `D+${daysDiff}`;
                            event.title = `D+${daysDiff}`;
                            eventsDiv.appendChild(event);
                        }
                    }
                }
                
                // ÏùºÏ†ï Ï≤¥ÌÅ¨
                const dateKey = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${currentDate.getDate()}`;
                if (events[dateKey] && events[dateKey].length > 0) {
                    const event = document.createElement('div');
                    event.className = 'calendar-event schedule';
                    const eventTitles = events[dateKey].map(e => e.title).join(', ');
                    event.title = eventTitles;
                    eventsDiv.appendChild(event);
                }
                
                // ÎÇ†Ïßú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä
                if (isCurrentMonth) {
                    dayDiv.style.cursor = 'pointer';
                    dayDiv.onclick = () => openEventModal(currentDate);
                }
                
                dayDiv.appendChild(eventsDiv);
                calendarGrid.appendChild(dayDiv);
            }
            
            // ÏùºÏ†ï Î™©Î°ù ÌëúÏãú
            loadEventsList();
        }
        
        // ÏùºÏ†ï Î™©Î°ù Î°úÎìú
        async function loadEventsList() {
            const eventsRef = ref(database, 'events');
            const eventsSnapshot = await get(eventsRef);
            const container = document.getElementById('eventsListContainer');
            
            container.innerHTML = '';
            
            if (!eventsSnapshot.exists()) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Îì±Î°ùÎêú ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            const eventsData = eventsSnapshot.val();
            const eventsArray = Object.entries(eventsData)
                .map(([id, event]) => ({
                    id,
                    ...event,
                    date: new Date(event.date)
                }))
                .sort((a, b) => a.date - b.date);
            
            eventsArray.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'event-item';
                
                const dateStr = event.date.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const currentUserName = localStorage.getItem('bamboo_userName');
                const isOwner = event.author === currentUserName;
                const deleteBtn = isOwner ? `<button class="event-delete-btn" onclick="deleteEvent('${event.id}')">ÏÇ≠Ï†ú</button>` : '';
                
                eventDiv.innerHTML = `
                    <div class="event-item-header">
                        <span class="event-date">${dateStr}</span>
                        ${deleteBtn}
                    </div>
                    <div class="event-title">${event.title}</div>
                    ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                `;
                
                container.appendChild(eventDiv);
            });
        }
        
        // ÏùºÏ†ï Î™®Îã¨ Ïó¥Í∏∞
        window.openEventModal = function(date) {
            const modal = document.getElementById('eventModal');
            const dateInput = document.getElementById('eventDate');
            const titleInput = document.getElementById('eventTitle');
            const descInput = document.getElementById('eventDescription');
            
            dateInput.value = date.toISOString().split('T')[0];
            titleInput.value = '';
            descInput.value = '';
            
            const dateStr = date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('eventModalTitle').textContent = `${dateStr} ÏùºÏ†ï Ï∂îÍ∞Ä`;
            
            modal.classList.add('show');
        };
        
        // ÏùºÏ†ï Î™®Îã¨ Îã´Í∏∞
        window.closeEventModal = function() {
            document.getElementById('eventModal').classList.remove('show');
        };
        
        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        document.getElementById('eventModal').addEventListener('click', (e) => {
            if (e.target.id === 'eventModal') {
                closeEventModal();
            }
        });
        
        // ÏùºÏ†ï Ï∂îÍ∞Ä
        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const date = document.getElementById('eventDate').value;
            const title = document.getElementById('eventTitle').value.trim();
            const description = document.getElementById('eventDescription').value.trim();
            
            if (!title) {
                alert('ÏùºÏ†ï Ï†úÎ™©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                const userName = localStorage.getItem('bamboo_userName');
                const eventsRef = ref(database, 'events');
                const newEventRef = push(eventsRef);
                
                await set(newEventRef, {
                    date: date,
                    title: title,
                    description: description || '',
                    author: userName,
                    createdAt: new Date().toISOString()
                });
                
                // ÏùºÏ†ï Ï∂îÍ∞Ä Ïãú ÏïåÎ¶º Ìä∏Î¶¨Í±∞
                await sendNotificationToUsers({
                    title: 'ÏÉà ÏùºÏ†ïÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§',
                    body: `${userName}ÎãòÏù¥ "${title}" ÏùºÏ†ïÏùÑ Ï∂îÍ∞ÄÌñàÏäµÎãàÎã§.`,
                    type: 'event',
                    eventId: newEventRef.key
                });
                
                closeEventModal();
                renderCalendar();
                alert('ÏùºÏ†ïÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!');
            } catch (error) {
                console.error('ÏùºÏ†ï Ï∂îÍ∞Ä Ïò§Î•ò:', error);
                alert('ÏùºÏ†ï Ï∂îÍ∞ÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        });
        
        // ÏùºÏ†ï ÏÇ≠Ï†ú
        window.deleteEvent = async function(eventId) {
            if (!confirm('Ï†ïÎßê Ïù¥ ÏùºÏ†ïÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }
            
            try {
                const eventRef = ref(database, `events/${eventId}`);
                await remove(eventRef);
                renderCalendar();
                alert('ÏùºÏ†ïÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
            } catch (error) {
                console.error('ÏùºÏ†ï ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                alert('ÏùºÏ†ï ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // Ïõî Î≥ÄÍ≤Ω
        window.changeMonth = function(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            renderCalendar();
        };
        
        // ÌÉ≠Î≥Ñ Í∏Ä Î™©Î°ù Î°úÎìú
        function loadTabPosts(tabName) {
            const postsRef = ref(database, `posts/${tabName}`);
            const postsContainer = document.getElementById(`${tabName}Posts`);
            
            onValue(postsRef, (snapshot) => {
                postsContainer.innerHTML = '';
                
                if (!snapshot.exists()) {
                    postsContainer.innerHTML = '<div class="loading">ÏïÑÏßÅ Í∏ÄÏù¥ ÏóÜÏäµÎãàÎã§. Ï≤´ Í∏ÄÏùÑ ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî! üíï</div>';
                    return;
                }
                
                const posts = snapshot.val();
                const postsArray = Object.entries(posts).sort((a, b) => {
                    return new Date(b[1].createdAt) - new Date(a[1].createdAt);
                });
                
                postsArray.forEach(([postId, post]) => {
                    const postElement = createPostElement(postId, post, tabName);
                    postsContainer.appendChild(postElement);
                });
            });
        }
        
        // Í∏Ä ÏöîÏÜå ÏÉùÏÑ±
        function createPostElement(postId, post, tabName) {
            const postDiv = document.createElement('div');
            postDiv.className = 'post';
            
            const date = new Date(post.createdAt);
            const dateStr = date.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Î≥∏Ïù∏ Í∏Ä ÌôïÏù∏
            const currentUserName = localStorage.getItem('bamboo_userName');
            const isOwner = post.author === currentUserName;
            const isAdmin = localStorage.getItem('bamboo_isAdmin') === 'true';
            
            // Î≥∏Ïù∏ Í∏Ä ÎòêÎäî Í¥ÄÎ¶¨ÏûêÏù∏ Í≤ΩÏö∞ ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº ÌëúÏãú
            let actionButtonsHTML = '';
            if (isOwner || isAdmin) {
                if (isOwner) {
                    actionButtonsHTML = `
                        <button class="edit-btn" onclick="editPost('${postId}', '${tabName}')">ÏàòÏ†ï</button>
                        <button class="delete-btn" onclick="deletePost('${postId}', '${tabName}')">ÏÇ≠Ï†ú</button>
                    `;
                } else if (isAdmin) {
                    actionButtonsHTML = `<button class="delete-btn" onclick="deletePost('${postId}', '${tabName}')">ÏÇ≠Ï†ú</button>`;
                }
            }
            
            let mediaHTML = '';
            if (post.media && post.media.length > 0) {
                if (post.media.length === 1) {
                    if (post.media[0].type === 'video') {
                        mediaHTML = `<div class="post-media"><video controls><source src="${post.media[0].url}" type="video/mp4"></video></div>`;
                    } else {
                        mediaHTML = `<div class="post-media"><img src="${post.media[0].url}" alt="Ïù¥ÎØ∏ÏßÄ"></div>`;
                    }
                } else {
                    mediaHTML = '<div class="post-media-grid">';
                    post.media.forEach(media => {
                        if (media.type === 'video') {
                            mediaHTML += `<video controls><source src="${media.url}" type="video/mp4"></video>`;
                        } else {
                            mediaHTML += `<img src="${media.url}" alt="Ïù¥ÎØ∏ÏßÄ">`;
                        }
                    });
                    mediaHTML += '</div>';
                }
            }
            
            const contentHTML = post.content ? `<div class="post-content">${post.content}</div>` : '';
            
            postDiv.innerHTML = `
                <div class="post-header">
                    <div>
                        <div class="post-author">üë§ ${post.author}</div>
                        <div class="post-date">üìÖ ${dateStr}</div>
                    </div>
                    <div class="post-actions">
                        ${actionButtonsHTML}
                    </div>
                </div>
                ${contentHTML}
                ${mediaHTML}
                <div class="comments-section">
                    <div id="comments-${tabName}-${postId}"></div>
                    <div class="comment-form">
                        <input type="text" class="comment-input" id="comment-input-${tabName}-${postId}" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." data-post-id="${postId}" data-tab="${tabName}">
                        <button type="button" class="comment-submit-inline comment-submit-btn" data-post-id="${postId}" data-tab="${tabName}" title="ÎåìÍ∏Ä ÏûëÏÑ±"></button>
                    </div>
                </div>
            `;
            
            // DOMÏóê Ï∂îÍ∞ÄÌïú ÌõÑ ÎåìÍ∏Ä Î°úÎìú
            // setTimeoutÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ DOMÏù¥ ÏôÑÏ†ÑÌûà Î†åÎçîÎßÅÎêú ÌõÑ ÎåìÍ∏Ä Î°úÎìú
            setTimeout(() => {
                loadComments(postId, tabName);
            }, 0);
            
            return postDiv;
        }
        
        // ÎåìÍ∏Ä Î°úÎìú (Î¶¨Ïä§ÎÑà Í¥ÄÎ¶¨Ïö©)
        const commentListeners = new Map();
        
        function loadComments(postId, tabName) {
            const commentsRef = ref(database, `posts/${tabName}/${postId}/comments`);
            const listenerKey = `${tabName}-${postId}`;
            const containerId = `comments-${tabName}-${postId}`;
            
            console.log('ÎåìÍ∏Ä Î°úÎìú ÏãúÏûë:', { postId, tabName, containerId });
            
            // Í∏∞Ï°¥ Î¶¨Ïä§ÎÑàÍ∞Ä ÏûàÏúºÎ©¥ Ï†úÍ±∞ (off Ìï®Ïàò ÏÇ¨Ïö©)
            if (commentListeners.has(listenerKey)) {
                const unsubscribe = commentListeners.get(listenerKey);
                if (unsubscribe) {
                    unsubscribe();
                }
            }
            
            // ÎåìÍ∏Ä ÌëúÏãú Ìï®Ïàò
            const renderComments = (snapshot) => {
                const commentsContainer = document.getElementById(containerId);
                if (!commentsContainer) {
                    console.warn('ÎåìÍ∏Ä Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', containerId);
                    // DOMÏù¥ Ï§ÄÎπÑÎê† ÎïåÍπåÏßÄ Í∏∞Îã§Î†∏Îã§Í∞Ä Îã§Ïãú ÏãúÎèÑ
                    setTimeout(() => {
                        renderComments(snapshot);
                    }, 100);
                    return;
                }
                
                commentsContainer.innerHTML = '';
                
                if (!snapshot.exists()) {
                    console.log('ÎåìÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                const comments = snapshot.val();
                console.log('ÎåìÍ∏Ä Îç∞Ïù¥ÌÑ∞ ÏàòÏã†:', comments);
                
                const commentsArray = Object.entries(comments).sort((a, b) => {
                    return new Date(a[1].createdAt) - new Date(b[1].createdAt);
                });
                
                console.log(`ÎåìÍ∏Ä ${commentsArray.length}Í∞úÎ•º ÌëúÏãúÌï©ÎãàÎã§.`);
                
                commentsArray.forEach(([commentId, comment]) => {
                    try {
                        const commentElement = createCommentElement(comment, commentId, postId, tabName);
                        commentsContainer.appendChild(commentElement);
                    } catch (error) {
                        console.error('ÎåìÍ∏Ä ÏöîÏÜå ÏÉùÏÑ± Ïò§Î•ò:', error, comment);
                    }
                });
                
                console.log(`${commentsArray.length}Í∞úÏùò ÎåìÍ∏ÄÏù¥ ÌëúÏãúÎêòÏóàÏäµÎãàÎã§.`);
            };
            
            // onValueÎäî unsubscribe Ìï®ÏàòÎ•º Î∞òÌôòÌï©ÎãàÎã§
            const unsubscribe = onValue(commentsRef, (snapshot) => {
                renderComments(snapshot);
            }, (error) => {
                console.error('ÎåìÍ∏Ä Î°úÎìú Ïò§Î•ò:', error);
            });
            
            commentListeners.set(listenerKey, unsubscribe);
        }
        
        // ÎåìÍ∏Ä ÏöîÏÜå ÏÉùÏÑ±
        function createCommentElement(comment, commentId, postId, tabName) {
            const commentDiv = document.createElement('div');
            commentDiv.className = 'comment';
            
            const date = new Date(comment.createdAt);
            const dateStr = date.toLocaleDateString('ko-KR', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Î≥∏Ïù∏ ÎåìÍ∏Ä ÌôïÏù∏
            const currentUserName = localStorage.getItem('bamboo_userName');
            const isOwner = comment.author === currentUserName;
            const deleteBtnHTML = isOwner ? `<button class="comment-delete-btn" onclick="deleteComment('${commentId}', '${postId}', '${tabName}')">ÏÇ≠Ï†ú</button>` : '';
            
            commentDiv.innerHTML = `
                <div class="comment-text">
                    <div class="comment-text-left">
                        <span class="comment-author">${comment.author}</span>
                        <span style="color: #999;">:</span>
                        <span class="comment-content">${comment.content}</span>
                        ${deleteBtnHTML}
                    </div>
                    <div class="comment-date">${dateStr}</div>
                </div>
            `;
            
            return commentDiv;
        }
        
        // ÎåìÍ∏Ä Ï∂îÍ∞Ä
        window.addComment = async function(postId, tabName, inputElement) {
            const content = inputElement.value.trim();
            if (!content) {
                alert('ÎåìÍ∏Ä ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (!postId || !tabName) {
                console.error('ÎåìÍ∏Ä Ï∂îÍ∞Ä Ïò§Î•ò: postId ÎòêÎäî tabNameÏù¥ ÏóÜÏäµÎãàÎã§.', { postId, tabName });
                alert('ÎåìÍ∏Ä ÏûëÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                const userName = localStorage.getItem('bamboo_userName');
                if (!userName) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    return;
                }
                
                console.log('ÎåìÍ∏Ä Ï∂îÍ∞Ä ÏãúÎèÑ:', { postId, tabName, userName, content });
                
                const commentsRef = ref(database, `posts/${tabName}/${postId}/comments`);
                const newCommentRef = push(commentsRef);
                
                const commentData = {
                    author: userName,
                    content: content,
                    createdAt: new Date().toISOString()
                };
                
                console.log('ÎåìÍ∏Ä Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•:', commentData);
                
                await set(newCommentRef, commentData);
                
                console.log('ÎåìÍ∏Ä Ï†ÄÏû• ÏôÑÎ£å');
                inputElement.value = '';
                
                // ÎåìÍ∏Ä Î™©Î°ùÏù¥ ÏûêÎèôÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÎèÑÎ°ù onValue Î¶¨Ïä§ÎÑàÍ∞Ä Ï≤òÎ¶¨Ìï®
                // Ï∂îÍ∞Ä ÌôïÏù∏ÏùÑ ÏúÑÌï¥ Ïû†Ïãú ÌõÑ Î°úÎìú
                setTimeout(() => {
                    const commentsContainer = document.getElementById(`comments-${tabName}-${postId}`);
                    if (commentsContainer) {
                        console.log('ÎåìÍ∏Ä Ïª®ÌÖåÏù¥ÎÑà ÌôïÏù∏:', commentsContainer.id);
                    } else {
                        console.error('ÎåìÍ∏Ä Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', `comments-${tabName}-${postId}`);
                    }
                }, 500);
            } catch (error) {
                console.error('ÎåìÍ∏Ä ÏûëÏÑ± Ïò§Î•ò:', error);
                console.error('Ïò§Î•ò ÏÉÅÏÑ∏:', {
                    message: error.message,
                    code: error.code,
                    postId,
                    tabName
                });
                alert('ÎåìÍ∏Ä ÏûëÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + (error.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
            }
        };
        
        // ÎåìÍ∏Ä ÏÇ≠Ï†ú
        window.deleteComment = async function(commentId, postId, tabName) {
            try {
                const currentUserName = localStorage.getItem('bamboo_userName');
                if (!currentUserName) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    return;
                }
                
                // ÎåìÍ∏Ä Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
                const commentRef = ref(database, `posts/${tabName}/${postId}/comments/${commentId}`);
                const commentSnapshot = await get(commentRef);
                
                if (!commentSnapshot.exists()) {
                    alert('ÎåìÍ∏ÄÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                const comment = commentSnapshot.val();
                
                // Î≥∏Ïù∏ ÎåìÍ∏ÄÏù∏ÏßÄ ÌôïÏù∏
                if (comment.author !== currentUserName) {
                    alert('Î≥∏Ïù∏Ïùò ÎåìÍ∏ÄÎßå ÏÇ≠Ï†úÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                    return;
                }
                
                if (!confirm('Ï†ïÎßê Ïù¥ ÎåìÍ∏ÄÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    return;
                }
                
                // ÎåìÍ∏Ä ÏÇ≠Ï†ú
                await remove(commentRef);
                alert('ÎåìÍ∏ÄÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                
            } catch (error) {
                console.error('ÎåìÍ∏Ä ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                alert('ÎåìÍ∏Ä ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï (Îçî Îπ†Î•∏ ÏóÖÎ°úÎìúÎ•º ÏúÑÌï¥ Îçî ÏûëÍ≤å)
        function compressImage(file, maxWidth = 1200, maxHeight = 1200, quality = 0.7) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onerror = reject;
                reader.onload = (e) => {
                    const img = new Image();
                    img.onerror = reject;
                    img.onload = () => {
                        try {
                            const canvas = document.createElement('canvas');
                            let width = img.width;
                            let height = img.height;
                            
                            // ÎπÑÏú® Ïú†ÏßÄÌïòÎ©¥ÏÑú ÌÅ¨Í∏∞ Ï°∞Ï†ï
                            if (width > height) {
                                if (width > maxWidth) {
                                    height = (height * maxWidth) / width;
                                    width = maxWidth;
                                }
                            } else {
                                if (height > maxHeight) {
                                    width = (width * maxHeight) / height;
                                    height = maxHeight;
                                }
                            }
                            
                            canvas.width = width;
                            canvas.height = height;
                            
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);
                            
                            canvas.toBlob((blob) => {
                                if (blob) {
                                    resolve(blob);
                                } else {
                                    reject(new Error('Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï Ïã§Ìå®'));
                                }
                            }, 'image/jpeg', quality);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }
        
        // ÎØ∏ÎîîÏñ¥ ÏÑ†ÌÉù Ï≤òÎ¶¨
        window.handleMediaSelect = async function(event) {
            try {
                const files = Array.from(event.target.files);
                const preview = document.getElementById('mediaPreview');
                
                if (!preview) {
                    console.error('ÎØ∏Î¶¨Î≥¥Í∏∞ Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                preview.innerHTML = '';
                
                if (files.length === 0) {
                    return;
                }
                
                window.selectedMedia = [];
                
                for (const file of files) {
                    const isImage = file.type.startsWith('image/');
                    const isVideo = file.type.startsWith('video/');
                    
                    if (!isImage && !isVideo) {
                        alert(`${file.name}ÏùÄ(Îäî) ÏßÄÏõêÌïòÏßÄ ÏïäÎäî ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§.`);
                        continue;
                    }
                    
                    // ÌååÏùº ÌÅ¨Í∏∞ Ï≤¥ÌÅ¨ (100MB Ï†úÌïú)
                    const maxSize = 100 * 1024 * 1024; // 100MB
                    if (file.size > maxSize) {
                        alert(`${file.name}Ïùò ÌÅ¨Í∏∞Í∞Ä ÎÑàÎ¨¥ ÌÅΩÎãàÎã§. (ÏµúÎåÄ 100MB)`);
                        continue;
                    }
                    
                    let processedFile = file;
                    let previewUrl = URL.createObjectURL(file);
                    
                // Ïù¥ÎØ∏ÏßÄÏù∏ Í≤ΩÏö∞ ÏïïÏ∂ï (300KB Ïù¥ÏÉÅÏù¥Î©¥ ÏïïÏ∂ï)
                if (isImage && file.size > 300 * 1024) {
                        try {
                            processedFile = await compressImage(file);
                            URL.revokeObjectURL(previewUrl); // Ïù¥Ï†Ñ URL Ìï¥Ï†ú
                            previewUrl = URL.createObjectURL(processedFile);
                        } catch (compressError) {
                            console.error('Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï Ïò§Î•ò:', compressError);
                            // ÏïïÏ∂ï Ïã§Ìå® Ïãú ÏõêÎ≥∏ ÌååÏùº ÏÇ¨Ïö©
                        }
                    }
                    
                    window.selectedMedia.push({
                        file: processedFile,
                        type: isImage ? 'image' : 'video',
                        previewUrl: previewUrl,
                        originalName: file.name
                    });
                    
                    // ÎØ∏Î¶¨Î≥¥Í∏∞ Ï∂îÍ∞Ä
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'media-item';
                    
                    if (isImage) {
                        mediaItem.innerHTML = `<img src="${previewUrl}" alt="ÎØ∏Î¶¨Î≥¥Í∏∞"><button class="remove-btn" onclick="removeMedia(${window.selectedMedia.length - 1})">√ó</button>`;
                    } else {
                        mediaItem.innerHTML = `<video src="${previewUrl}" controls></video><button class="remove-btn" onclick="removeMedia(${window.selectedMedia.length - 1})">√ó</button>`;
                    }
                    
                    preview.appendChild(mediaItem);
                }
                
                if (window.selectedMedia.length > 0) {
                    console.log(`${window.selectedMedia.length}Í∞úÏùò ÌååÏùºÏù¥ ÏÑ†ÌÉùÎêòÏóàÏäµÎãàÎã§.`);
                }
            } catch (error) {
                console.error('ÎØ∏ÎîîÏñ¥ ÏÑ†ÌÉù Ï≤òÎ¶¨ Ïò§Î•ò:', error);
                alert('ÌååÏùº ÏÑ†ÌÉù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
            }
        };
        
        // ÎØ∏ÎîîÏñ¥ Ï†úÍ±∞
        window.removeMedia = function(index) {
            window.selectedMedia.splice(index, 1);
            const preview = document.getElementById('mediaPreview');
            preview.innerHTML = '';
            
            window.selectedMedia.forEach((media, idx) => {
                const mediaItem = document.createElement('div');
                mediaItem.className = 'media-item';
                if (media.type === 'image') {
                    mediaItem.innerHTML = `<img src="${media.previewUrl}" alt="ÎØ∏Î¶¨Î≥¥Í∏∞"><button class="remove-btn" onclick="removeMedia(${idx})">√ó</button>`;
                } else {
                    mediaItem.innerHTML = `<video src="${media.previewUrl}" controls></video><button class="remove-btn" onclick="removeMedia(${idx})">√ó</button>`;
                }
                preview.appendChild(mediaItem);
            });
        };
        
        // Í∏Ä ÏûëÏÑ± Î™®Îã¨ Ïó¥Í∏∞
        window.openWriteModal = function() {
            const currentTab = window.currentTab;
            const modal = document.getElementById('writeModal');
            const titleEl = document.getElementById('writeModalTitle');
            const mediaSection = document.getElementById('mediaUploadSection');
            const contentInput = document.getElementById('writeContent');
            const submitBtn = document.getElementById('writeSubmitBtn');
            
            // ÌÉ≠Ïóê ÎßûÍ≤å Ï†úÎ™© Î≥ÄÍ≤Ω
            if (currentTab === 'praise') {
                titleEl.textContent = 'üíï Ïπ≠Ï∞¨ÌïòÍ∏∞';
                contentInput.placeholder = 'Ïπ≠Ï∞¨ÌïòÍ≥† Ïã∂ÏùÄ ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî üí≠';
                mediaSection.style.display = 'none';
                contentInput.required = true;
            } else if (currentTab === 'complaint') {
                titleEl.textContent = 'üì¢ ÎØºÏõêÏ†úÍ∏∞';
                contentInput.placeholder = 'ÎØºÏõê ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî üìù';
                mediaSection.style.display = 'none';
                contentInput.required = true;
            } else if (currentTab === 'daily') {
                titleEl.textContent = 'üì∏ ÏùºÏÉÅÎ°úÍ∑∏';
                contentInput.placeholder = 'Î¨¥ÏóáÏùÑ ÏÉùÍ∞ÅÌïòÍ≥† Í≥ÑÏã†Í∞ÄÏöî? üí≠ (ÏÑ†ÌÉùÏÇ¨Ìï≠)';
                mediaSection.style.display = 'block';
                contentInput.required = false;
            }
            
            // ÏàòÏ†ï Î™®Îìú Ï¥àÍ∏∞Ìôî
            document.getElementById('editPostId').value = '';
            document.getElementById('editTabName').value = '';
            submitBtn.textContent = 'ÏûëÏÑ±ÌïòÍ∏∞';
            
            modal.classList.add('show');
        };
        
        // Í∏Ä ÏûëÏÑ± Î™®Îã¨ Îã´Í∏∞
        window.closeWriteModal = function() {
            const modal = document.getElementById('writeModal');
            modal.classList.remove('show');
            document.getElementById('writeForm').reset();
            document.getElementById('mediaPreview').innerHTML = '';
            window.selectedMedia = [];
            document.getElementById('editPostId').value = '';
            document.getElementById('editTabName').value = '';
        };
        
        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        document.getElementById('writeModal').addEventListener('click', (e) => {
            if (e.target.id === 'writeModal') {
                closeWriteModal();
            }
        });
        
        // Í∏Ä ÏàòÏ†ï
        window.editPost = async function(postId, tabName) {
            try {
                const postRef = ref(database, `posts/${tabName}/${postId}`);
                const postSnapshot = await get(postRef);
                
                if (!postSnapshot.exists()) {
                    alert('Í∏ÄÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                const post = postSnapshot.val();
                const currentUserName = localStorage.getItem('bamboo_userName');
                
                if (post.author !== currentUserName) {
                    alert('Î≥∏Ïù∏Ïùò Í∏ÄÎßå ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                    return;
                }
                
                // Î™®Îã¨ Ïó¥Í∏∞
                const modal = document.getElementById('writeModal');
                const titleEl = document.getElementById('writeModalTitle');
                const contentInput = document.getElementById('writeContent');
                const mediaSection = document.getElementById('mediaUploadSection');
                const submitBtn = document.getElementById('writeSubmitBtn');
                
                // ÌÉ≠Ïóê ÎßûÍ≤å ÏÑ§Ï†ï
                if (tabName === 'praise') {
                    titleEl.textContent = 'üíï Ïπ≠Ï∞¨ÌïòÍ∏∞ ÏàòÏ†ï';
                    mediaSection.style.display = 'none';
                } else if (tabName === 'complaint') {
                    titleEl.textContent = 'üì¢ ÎØºÏõêÏ†úÍ∏∞ ÏàòÏ†ï';
                    mediaSection.style.display = 'none';
                } else if (tabName === 'daily') {
                    titleEl.textContent = 'üì∏ ÏùºÏÉÅÎ°úÍ∑∏ ÏàòÏ†ï';
                    mediaSection.style.display = 'block';
                    // Í∏∞Ï°¥ ÎØ∏ÎîîÏñ¥Îäî ÏàòÏ†ï Î∂àÍ∞Ä (ÏÉàÎ°ú ÏóÖÎ°úÎìúÎßå Í∞ÄÎä•)
                }
                
                // ÎÇ¥Ïö© Ï±ÑÏö∞Í∏∞
                contentInput.value = post.content || '';
                document.getElementById('editPostId').value = postId;
                document.getElementById('editTabName').value = tabName;
                submitBtn.textContent = 'ÏàòÏ†ïÌïòÍ∏∞';
                
                modal.classList.add('show');
                
            } catch (error) {
                console.error('Í∏Ä ÏàòÏ†ï Ïò§Î•ò:', error);
                alert('Í∏ÄÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // ÌÜµÌï© Í∏Ä ÏûëÏÑ±/ÏàòÏ†ï
        document.getElementById('writeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            const content = document.getElementById('writeContent').value.trim();
            const editPostId = document.getElementById('editPostId').value;
            const editTabName = document.getElementById('editTabName').value;
            const currentTab = editTabName || window.currentTab;
            const hasMedia = window.selectedMedia && window.selectedMedia.length > 0;
            const isEditMode = editPostId !== '';
            
            try {
                // Í≤ÄÏ¶ù
                if (currentTab === 'daily') {
                    if (!content && !hasMedia) {
                        alert('Í∏Ä ÎòêÎäî ÏÇ¨ÏßÑ/ÏòÅÏÉÅÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                } else {
                    if (!content) {
                        alert('ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                }
                
                // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Î∞è Î°úÎî© ÌëúÏãú
                submitBtn.disabled = true;
                submitBtn.textContent = isEditMode ? 'ÏàòÏ†ï Ï§ë...' : 'ÏóÖÎ°úÎìú Ï§ë...';
                
                const userName = localStorage.getItem('bamboo_userName');
                let postId;
                let postRef;
                
                if (isEditMode) {
                    // ÏàòÏ†ï Î™®Îìú
                    postId = editPostId;
                    postRef = ref(database, `posts/${currentTab}/${postId}`);
                    
                    // Î≥∏Ïù∏ Í∏Ä ÌôïÏù∏
                    const postSnapshot = await get(postRef);
                    if (!postSnapshot.exists() || postSnapshot.val().author !== userName) {
                        alert('Î≥∏Ïù∏Ïùò Í∏ÄÎßå ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                        return;
                    }
                } else {
                    // ÏûëÏÑ± Î™®Îìú
                    const postsRef = ref(database, `posts/${currentTab}`);
                    const newPostRef = push(postsRef);
                    postId = newPostRef.key;
                    postRef = newPostRef;
                }
                
                let mediaUrls = [];
                
                // ÏùºÏÉÅÎ°úÍ∑∏Ïù¥Í≥† ÎØ∏ÎîîÏñ¥Í∞Ä ÏûàÎäî Í≤ΩÏö∞ ÏóÖÎ°úÎìú
                if (currentTab === 'daily' && hasMedia) {
                    submitBtn.textContent = `ÏóÖÎ°úÎìú Ï§ë... (0/${window.selectedMedia.length})`;
                    
                    // UUID ÏÉùÏÑ± Ìï®Ïàò
                    const generateUUID = () => {
                        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
                            const r = Math.random() * 16 | 0;
                            const v = c === 'x' ? r : (r & 0x3 | 0x8);
                            return v.toString(16);
                        });
                    };
                    
                    const uploadPromises = window.selectedMedia.map(async (media, i) => {
                        const uuid = generateUUID();
                        const random = Math.random().toString(36).substring(2, 15);
                        const fileName = `${uuid}_${Date.now()}_${random}.${media.type === 'image' ? 'jpg' : 'mp4'}`;
                        const mediaStorageRef = storageRef(storage, `daily/${postId}/${fileName}`);
                        
                        try {
                            await uploadBytes(mediaStorageRef, media.file);
                            const downloadURL = await getDownloadURL(mediaStorageRef);
                            
                            const completed = i + 1;
                            submitBtn.textContent = `ÏóÖÎ°úÎìú Ï§ë... (${completed}/${window.selectedMedia.length})`;
                            
                            return {
                                url: downloadURL,
                                type: media.type
                            };
                        } catch (uploadError) {
                            console.error('ÎØ∏ÎîîÏñ¥ ÏóÖÎ°úÎìú Ïò§Î•ò:', uploadError);
                            throw new Error(`ÌååÏùº ÏóÖÎ°úÎìú Ïã§Ìå®: ${uploadError.message}`);
                        }
                    });
                    
                    mediaUrls = await Promise.all(uploadPromises);
                } else if (isEditMode && currentTab === 'daily') {
                    // ÏàòÏ†ï Î™®Îìú: Í∏∞Ï°¥ ÎØ∏ÎîîÏñ¥ Ïú†ÏßÄ
                    const postSnapshot = await get(postRef);
                    if (postSnapshot.exists() && postSnapshot.val().media) {
                        mediaUrls = postSnapshot.val().media;
                    }
                }
                
                // Í∏Ä Ï†ÄÏû•/ÏàòÏ†ï
                submitBtn.textContent = isEditMode ? 'ÏàòÏ†ï Ï§ë...' : 'Ï†ÄÏû• Ï§ë...';
                const postData = {
                    author: userName,
                    createdAt: isEditMode ? (await get(postRef)).val().createdAt : new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (content) {
                    postData.content = content;
                }
                
                if (currentTab === 'daily' && mediaUrls.length > 0) {
                    postData.media = mediaUrls;
                }
                
                await set(postRef, postData);
                
                // ÏÉà Í∏Ä ÏûëÏÑ± Ïãú ÏïåÎ¶º Ìä∏Î¶¨Í±∞ (ÏàòÏ†ïÏù¥ ÏïÑÎãê ÎïåÎßå)
                if (!isEditMode) {
                    const tabNames = {
                        'praise': 'Ïπ≠Ï∞¨ÌïòÍ∏∞',
                        'complaint': 'ÎØºÏõêÏ†úÍ∏∞',
                        'daily': 'ÏùºÏÉÅÎ°úÍ∑∏'
                    };
                    await sendNotificationToUsers({
                        title: 'ÏÉà Í∏ÄÏù¥ Îì±Î°ùÎêòÏóàÏäµÎãàÎã§',
                        body: `${userName}ÎãòÏù¥ ${tabNames[currentTab]}Ïóê ÏÉà Í∏ÄÏùÑ ÏûëÏÑ±ÌñàÏäµÎãàÎã§.`,
                        type: 'post',
                        tab: currentTab,
                        postId: postId
                    });
                }
                
                // Ìèº Ï¥àÍ∏∞Ìôî Î∞è Î™®Îã¨ Îã´Í∏∞
                closeWriteModal();
                alert(isEditMode ? 'ÏàòÏ†ïÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!' : 'ÏûëÏÑ±Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!');
                
            } catch (error) {
                console.error('Í∏Ä ÏûëÏÑ±/ÏàòÏ†ï Ïò§Î•ò:', error);
                let errorMessage = isEditMode ? 'ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.' : 'ÏûëÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.';
                
                if (error.message.includes('storage/unauthorized')) {
                    errorMessage = 'Firebase StorageÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. Firebase ConsoleÏóêÏÑú StorageÎ•º ÌôúÏÑ±ÌôîÌï¥Ï£ºÏÑ∏Ïöî.';
                } else if (error.message.includes('storage/quota-exceeded')) {
                    errorMessage = 'Ï†ÄÏû• Í≥µÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                alert(errorMessage);
            } finally {
                // Î≤ÑÌäº Î≥µÏõê
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });
        
        // Í∏Ä ÏÇ≠Ï†ú (Î≥∏Ïù∏ ÎòêÎäî Í¥ÄÎ¶¨Ïûê)
        window.deletePost = async function(postId, tabName) {
            const currentUserName = localStorage.getItem('bamboo_userName');
            const isAdmin = localStorage.getItem('bamboo_isAdmin') === 'true';
            
            try {
                // Í∏Ä Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                const postRef = ref(database, `posts/${tabName}/${postId}`);
                const postSnapshot = await get(postRef);
                
                if (!postSnapshot.exists()) {
                    alert('Í∏ÄÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                const post = postSnapshot.val();
                
                // Î≥∏Ïù∏ Í∏Ä ÎòêÎäî Í¥ÄÎ¶¨ÏûêÏù∏ÏßÄ ÌôïÏù∏
                if (post.author !== currentUserName && !isAdmin) {
                    alert('Î≥∏Ïù∏Ïùò Í∏ÄÎßå ÏÇ≠Ï†úÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                    return;
                }
                
                if (!confirm('Ï†ïÎßê Ïù¥ Í∏ÄÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    return;
                }
                
                // ÏùºÏÉÅÎ°úÍ∑∏Ïù∏ Í≤ΩÏö∞ StorageÏóêÏÑú ÎØ∏ÎîîÏñ¥ ÌååÏùº ÏÇ≠Ï†ú
                if (tabName === 'daily' && post.media && post.media.length > 0) {
                    for (const media of post.media) {
                        try {
                            // URLÏóêÏÑú ÌååÏùº Í≤ΩÎ°ú Ï∂îÏ∂ú
                            const url = media.url;
                            const pathMatch = url.match(/daily%2F([^?]+)/);
                            if (pathMatch) {
                                const filePath = `daily/${decodeURIComponent(pathMatch[1])}`;
                                const mediaStorageRef = storageRef(storage, filePath);
                                await deleteObject(mediaStorageRef);
                            }
                        } catch (error) {
                            console.error('ÎØ∏ÎîîÏñ¥ ÌååÏùº ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                        }
                    }
                }
                
                // DatabaseÏóêÏÑú Í∏Ä ÏÇ≠Ï†ú (ÎåìÍ∏ÄÎèÑ Ìï®Íªò ÏÇ≠Ï†úÎê®)
                await remove(postRef);
                alert('Í∏ÄÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                
            } catch (error) {
                console.error('Í∏Ä ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                alert('Í∏Ä ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨ Î™®Îã¨ Ïó¥Í∏∞
        window.openUserManagementModal = function() {
            const modal = document.getElementById('approveModal');
            modal.classList.add('show');
            showPendingUsers(); // Í∏∞Î≥∏ÏúºÎ°ú ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù ÌëúÏãú
        };
        
        // ÏäπÏù∏ ÎåÄÍ∏∞ ÏÇ¨Ïö©Ïûê ÌëúÏãú
        window.showPendingUsers = async function() {
            const pendingUsersDiv = document.getElementById('pendingUsers');
            
            try {
                const usersRef = ref(database, 'users');
                const snapshot = await get(usersRef);
                
                pendingUsersDiv.innerHTML = '<p style="text-align: center; padding: 20px;">Î°úÎî© Ï§ë...</p>';
                
                if (!snapshot.exists()) {
                    pendingUsersDiv.innerHTML = '<p style="text-align: center; padding: 20px;">ÎåÄÍ∏∞ Ï§ëÏù∏ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                    return;
                }
                
                const users = snapshot.val();
                pendingUsersDiv.innerHTML = '';
                let hasPending = false;
                
                for (const [userId, user] of Object.entries(users)) {
                    if (!user.approved && user.name !== 'admin') {
                        hasPending = true;
                        const userDiv = document.createElement('div');
                        userDiv.className = 'pending-user';
                        userDiv.innerHTML = `
                            <div class="user-details">
                                <strong>Ïù¥Î¶Ñ:</strong> ${user.name}<br>
                                <strong>ÏÉùÎÖÑÏõîÏùº:</strong> ${user.birthdate || 'ÏóÜÏùå'}<br>
                                <strong>Ìï∏ÎìúÌè∞:</strong> ${user.phone || 'ÏóÜÏùå'}<br>
                                <strong>Í∞ÄÏûÖÏùº:</strong> ${user.createdAt ? new Date(user.createdAt).toLocaleDateString('ko-KR') : 'ÏóÜÏùå'}
                            </div>
                            <div style="display: flex; gap: 5px; flex-direction: column;">
                                <button class="btn btn-pink" onclick="approveUser('${userId}')">ÏäπÏù∏</button>
                                <button class="btn" onclick="editUser('${userId}')" style="background: #ffb6c1;">ÏàòÏ†ï</button>
                                <button class="btn" onclick="deleteUser('${userId}')" style="background: #ff6b6b; color: white;">ÏÇ≠Ï†ú</button>
                            </div>
                        `;
                        pendingUsersDiv.appendChild(userDiv);
                    }
                }
                
                if (!hasPending) {
                    pendingUsersDiv.innerHTML = '<p style="text-align: center; padding: 20px;">ÎåÄÍ∏∞ Ï§ëÏù∏ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                }
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Î™©Î°ù Î°úÎìú Ïò§Î•ò:', error);
                alert('ÏÇ¨Ïö©Ïûê Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // Ï†ÑÏ≤¥ ÏÇ¨Ïö©Ïûê ÌëúÏãú
        window.showAllUsers = async function() {
            const pendingUsersDiv = document.getElementById('pendingUsers');
            
            try {
                const usersRef = ref(database, 'users');
                const snapshot = await get(usersRef);
                
                pendingUsersDiv.innerHTML = '<p style="text-align: center; padding: 20px;">Î°úÎî© Ï§ë...</p>';
                
                if (!snapshot.exists()) {
                    pendingUsersDiv.innerHTML = '<p style="text-align: center; padding: 20px;">ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                    return;
                }
                
                const users = snapshot.val();
                pendingUsersDiv.innerHTML = '';
                
                for (const [userId, user] of Object.entries(users)) {
                    if (user.name === 'admin') continue; // adminÏùÄ Ï†úÏô∏
                    
                    const userDiv = document.createElement('div');
                    userDiv.className = 'pending-user';
                    const approvedBadge = user.approved ? '<span style="color: green; font-weight: bold;">‚úì ÏäπÏù∏Îê®</span>' : '<span style="color: orange;">ÎåÄÍ∏∞ Ï§ë</span>';
                    userDiv.innerHTML = `
                        <div class="user-details">
                            <strong>Ïù¥Î¶Ñ:</strong> ${user.name}<br>
                            <strong>ÏÉùÎÖÑÏõîÏùº:</strong> ${user.birthdate || 'ÏóÜÏùå'}<br>
                            <strong>Ìï∏ÎìúÌè∞:</strong> ${user.phone || 'ÏóÜÏùå'}<br>
                            <strong>Í∞ÄÏûÖÏùº:</strong> ${user.createdAt ? new Date(user.createdAt).toLocaleDateString('ko-KR') : 'ÏóÜÏùå'}<br>
                            <strong>ÏÉÅÌÉú:</strong> ${approvedBadge}
                        </div>
                        <div style="display: flex; gap: 5px; flex-direction: column;">
                            ${!user.approved ? `<button class="btn btn-pink" onclick="approveUser('${userId}')">ÏäπÏù∏</button>` : ''}
                            <button class="btn" onclick="editUser('${userId}')" style="background: #ffb6c1;">ÏàòÏ†ï</button>
                            <button class="btn" onclick="deleteUser('${userId}')" style="background: #ff6b6b; color: white;">ÏÇ≠Ï†ú</button>
                        </div>
                    `;
                    pendingUsersDiv.appendChild(userDiv);
                }
                
                if (pendingUsersDiv.children.length === 0) {
                    pendingUsersDiv.innerHTML = '<p style="text-align: center; padding: 20px;">ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                }
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Î™©Î°ù Î°úÎìú Ïò§Î•ò:', error);
                alert('ÏÇ¨Ïö©Ïûê Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // ÏÇ¨Ïö©Ïûê ÏäπÏù∏
        window.approveUser = async function(userId) {
            try {
                await set(ref(database, `users/${userId}/approved`), true);
                alert('ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§!');
                showPendingUsers(); // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
            } catch (error) {
                console.error('ÏäπÏù∏ Ïò§Î•ò:', error);
                alert('ÏäπÏù∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // ÏÇ¨Ïö©Ïûê ÏàòÏ†ï Î™®Îã¨ Ïó¥Í∏∞
        window.editUser = async function(userId) {
            try {
                const userRef = ref(database, `users/${userId}`);
                const snapshot = await get(userRef);
                
                if (!snapshot.exists()) {
                    alert('ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                const user = snapshot.val();
                document.getElementById('editUserId').value = userId;
                document.getElementById('editUserName').value = user.name || '';
                document.getElementById('editUserBirthdate').value = user.birthdate || '';
                document.getElementById('editUserPhone').value = user.phone || '';
                
                const editModal = document.getElementById('editUserModal');
                editModal.classList.add('show');
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î°úÎìú Ïò§Î•ò:', error);
                alert('ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï†ÄÏû•
        window.saveUserEdit = async function(event) {
            event.preventDefault();
            
            const userId = document.getElementById('editUserId').value;
            const name = document.getElementById('editUserName').value.trim();
            const birthdate = document.getElementById('editUserBirthdate').value;
            const phone = document.getElementById('editUserPhone').value.trim();
            
            if (!name) {
                alert('Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                // Ïù¥Î¶Ñ Ï§ëÎ≥µ Ï≤¥ÌÅ¨ (Î≥∏Ïù∏ Ï†úÏô∏)
                const usersRef = ref(database, 'users');
                const snapshot = await get(usersRef);
                
                if (snapshot.exists()) {
                    const users = snapshot.val();
                    for (const [uid, user] of Object.entries(users)) {
                        if (uid !== userId && user.name === name) {
                            alert('Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ëÏù∏ Ïù¥Î¶ÑÏûÖÎãàÎã§.');
                            return;
                        }
                    }
                }
                
                // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                const userRef = ref(database, `users/${userId}`);
                const currentUser = (await get(userRef)).val();
                
                const updates = {
                    name: name,
                    birthdate: birthdate || currentUser.birthdate || '',
                    phone: phone || currentUser.phone || ''
                };
                
                await update(userRef, updates);
                
                alert('ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Í∞Ä ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');
                closeEditUserModal();
                
                // ÌòÑÏû¨ ÌëúÏãú Ï§ëÏù∏ Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                const pendingUsersDiv = document.getElementById('pendingUsers');
                if (pendingUsersDiv.innerHTML.includes('ÎåÄÍ∏∞ Ï§ëÏù∏')) {
                    showPendingUsers();
                } else {
                    showAllUsers();
                }
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏàòÏ†ï Ïò§Î•ò:', error);
                alert('ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // ÏÇ¨Ïö©Ïûê ÏàòÏ†ï Î™®Îã¨ Îã´Í∏∞
        window.closeEditUserModal = function() {
            document.getElementById('editUserModal').classList.remove('show');
        };
        
        // ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú
        window.deleteUser = async function(userId) {
            if (!confirm('Ï†ïÎßê Ïù¥ ÏÇ¨Ïö©ÏûêÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏù¥ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûëÏÑ±Ìïú Î™®Îì† Í∏ÄÍ≥º ÎåìÍ∏ÄÏù¥ Ìï®Íªò ÏÇ≠Ï†úÎê©ÎãàÎã§.')) {
                return;
            }
            
            try {
                // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÌôïÏù∏
                const userRef = ref(database, `users/${userId}`);
                const userSnapshot = await get(userRef);
                
                if (!userSnapshot.exists()) {
                    alert('ÏÇ¨Ïö©ÏûêÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                const userName = userSnapshot.val().name;
                
                // ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûëÏÑ±Ìïú Î™®Îì† Í∏Ä ÏÇ≠Ï†ú
                const postsRef = ref(database, 'posts');
                const postsSnapshot = await get(postsRef);
                
                if (postsSnapshot.exists()) {
                    const posts = postsSnapshot.val();
                    for (const [tabName, tabPosts] of Object.entries(posts)) {
                        if (tabPosts) {
                            for (const [postId, post] of Object.entries(tabPosts)) {
                                if (post.author === userName) {
                                    const postRef = ref(database, `posts/${tabName}/${postId}`);
                                    
                                    // ÏùºÏÉÅÎ°úÍ∑∏Ïù∏ Í≤ΩÏö∞ StorageÏóêÏÑú ÎØ∏ÎîîÏñ¥ ÌååÏùº ÏÇ≠Ï†ú
                                    if (tabName === 'daily' && post.media && post.media.length > 0) {
                                        for (const media of post.media) {
                                            try {
                                                const url = media.url;
                                                const pathMatch = url.match(/daily%2F([^?]+)/);
                                                if (pathMatch) {
                                                    const filePath = `daily/${decodeURIComponent(pathMatch[1])}`;
                                                    const mediaStorageRef = storageRef(storage, filePath);
                                                    await deleteObject(mediaStorageRef);
                                                }
                                            } catch (error) {
                                                console.error('ÎØ∏ÎîîÏñ¥ ÌååÏùº ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                                            }
                                        }
                                    }
                                    
                                    await remove(postRef);
                                }
                            }
                        }
                    }
                }
                
                // ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú
                await remove(userRef);
                
                alert('ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
                
                // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                const pendingUsersDiv = document.getElementById('pendingUsers');
                if (pendingUsersDiv.innerHTML.includes('ÎåÄÍ∏∞ Ï§ëÏù∏')) {
                    showPendingUsers();
                } else {
                    showAllUsers();
                }
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                alert('ÏÇ¨Ïö©Ïûê ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        };
        
        // Î™®Îã¨ Îã´Í∏∞
        document.getElementById('approveModal').addEventListener('click', (e) => {
            if (e.target.id === 'approveModal') {
                document.getElementById('approveModal').classList.remove('show');
            }
        });
        
        document.getElementById('editUserModal').addEventListener('click', (e) => {
            if (e.target.id === 'editUserModal') {
                closeEditUserModal();
            }
        });
        
        
        // Î°úÍ∑∏ÏïÑÏõÉ
        window.logout = function() {
            localStorage.removeItem('bamboo_userId');
            localStorage.removeItem('bamboo_userName');
            localStorage.removeItem('bamboo_isAdmin');
            window.location.href = 'login.html';
        };
        
        // ÎåìÍ∏Ä Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ (Ïù¥Î≤§Ìä∏ ÏúÑÏûÑ)
        document.addEventListener('click', async (e) => {
            if (e.target.classList.contains('comment-submit-btn')) {
                e.preventDefault();
                const postId = e.target.dataset.postId;
                const tabName = e.target.dataset.tab;
                const inputElement = document.getElementById(`comment-input-${tabName}-${postId}`);
                if (inputElement) {
                    await addComment(postId, tabName, inputElement);
                }
            }
        });
        
        // ÏóîÌÑ∞ÌÇ§Î°ú ÎåìÍ∏Ä ÏûëÏÑ±
        document.addEventListener('keypress', async (e) => {
            if (e.target.classList.contains('comment-input') && e.key === 'Enter') {
                e.preventDefault();
                const postId = e.target.dataset.postId;
                const tabName = e.target.dataset.tab;
                if (postId && tabName) {
                    await addComment(postId, tabName, e.target);
                }
            }
        });
        
        // Î≥ÑÍ∞ÄÎ£® Ìö®Í≥º
        const sparkles = ['‚ú®', '‚≠ê', 'üí´', 'üåü', 'üíñ', 'üíï', 'üå∏', 'ü¶ã'];
        let sparkleCount = 0;
        const maxSparkles = 20; // ÏµúÎåÄ Î≥ÑÍ∞ÄÎ£® Í∞úÏàò Ï†úÌïú
        
        function createSparkle(x, y) {
            if (sparkleCount >= maxSparkles) return;
            
            sparkleCount++;
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            
            // ÎûúÎç§ Ïù¥Î™®ÏßÄ ÏÑ†ÌÉù
            const emoji = sparkles[Math.floor(Math.random() * sparkles.length)];
            sparkle.innerHTML = `<span class="sparkle-emoji">${emoji}</span>`;
            
            // ÎûúÎç§ ÏúÑÏπò Ïò§ÌîÑÏÖã
            const offsetX = (Math.random() - 0.5) * 50;
            const offsetY = (Math.random() - 0.5) * 50;
            
            sparkle.style.left = (x + offsetX) + 'px';
            sparkle.style.top = (y + offsetY) + 'px';
            
            // ÎûúÎç§ ÌÅ¨Í∏∞
            const size = 0.8 + Math.random() * 0.7;
            sparkle.style.fontSize = (size * 1.5) + 'em';
            
            // ÎûúÎç§ ÌöåÏ†Ñ Î∞©Ìñ•
            const rotation = Math.random() * 360;
            sparkle.style.setProperty('--rotation', rotation + 'deg');
            
            document.body.appendChild(sparkle);
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖò Ï¢ÖÎ£å ÌõÑ Ï†úÍ±∞
            setTimeout(() => {
                sparkle.remove();
                sparkleCount--;
            }, 1500);
        }
        
        // ÎßàÏö∞Ïä§ ÏõÄÏßÅÏûÑ Í∞êÏßÄ
        let mouseMoveTimer;
        document.addEventListener('mousemove', (e) => {
            // ÎÑàÎ¨¥ Îπ†Î•∏ ÎßàÏö∞Ïä§ ÏõÄÏßÅÏûÑ Ï†úÌïú (ÏÑ±Îä• ÏµúÏ†ÅÌôî)
            clearTimeout(mouseMoveTimer);
            mouseMoveTimer = setTimeout(() => {
                createSparkle(e.clientX, e.clientY);
            }, 50); // 50msÎßàÎã§ Î≥ÑÍ∞ÄÎ£® ÏÉùÏÑ±
        });
        
        // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏ Í∞êÏßÄ (Î™®Î∞îÏùº)
        let touchMoveTimer;
        document.addEventListener('touchmove', (e) => {
            if (e.touches.length > 0) {
                const touch = e.touches[0];
                clearTimeout(touchMoveTimer);
                touchMoveTimer = setTimeout(() => {
                    createSparkle(touch.clientX, touch.clientY);
                }, 100); // Î™®Î∞îÏùºÏùÄ Ï°∞Í∏à Îçî ÎäêÎ¶¨Í≤å
            }
        }, { passive: true });
        
        // ÌÅ¥Î¶≠/ÌÑ∞Ïπò ÏãúÏóêÎèÑ Î≥ÑÍ∞ÄÎ£® ÏÉùÏÑ±
        document.addEventListener('click', (e) => {
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    createSparkle(e.clientX, e.clientY);
                }, i * 50);
            }
        });
        
        // ÌÑ∞Ïπò Ï¢ÖÎ£å Ïãú Î≥ÑÍ∞ÄÎ£® ÏÉùÏÑ±
        document.addEventListener('touchend', (e) => {
            if (e.changedTouches.length > 0) {
                const touch = e.changedTouches[0];
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        createSparkle(touch.clientX, touch.clientY);
                    }, i * 50);
                }
            }
        }, { passive: true });
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
        loadUserInfo();
        
        // PWA Service Worker Îì±Î°ù
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // GitHub Pages Í≤ΩÎ°úÏóê ÎßûÍ≤å ÏàòÏ†ï
                const swPath = window.location.pathname.includes('/bamboo/') 
                    ? '/bamboo/sw.js' 
                    : '/sw.js';
                
                navigator.serviceWorker.register(swPath)
                    .then((registration) => {
                        console.log('Service Worker Îì±Î°ù ÏÑ±Í≥µ:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Service Worker Îì±Î°ù Ïã§Ìå®:', error);
                    });
            });
        }
        
        // Ìë∏Ïãú ÏïåÎ¶º Í∂åÌïú ÏöîÏ≤≠ Î∞è FCM Ï¥àÍ∏∞Ìôî
        async function initializePushNotifications(requestPermission = false) {
            if (!('Notification' in window)) {
                console.log('Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî ÏïåÎ¶ºÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                return false;
            }
            
            try {
                // ÌòÑÏû¨ Í∂åÌïú ÏÉÅÌÉú ÌôïÏù∏
                let permission = Notification.permission;
                
                // Í∂åÌïúÏù¥ Ï∞®Îã®Îêú Í≤ΩÏö∞
                if (permission === 'denied') {
                    console.warn('‚ö†Ô∏è ÏïåÎ¶º Í∂åÌïúÏù¥ Ï∞®Îã®ÎêòÏóàÏäµÎãàÎã§.');
                    alert('ÏïåÎ¶º Í∂åÌïúÏù¥ Ï∞®Îã®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.\n\nÎ∏åÎùºÏö∞Ï†Ä ÏÑ§Ï†ïÏóêÏÑú ÏïåÎ¶ºÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî:\n1. Ï£ºÏÜåÏ∞Ω ÏôºÏ™Ω ÏûêÎ¨ºÏá† ÏïÑÏù¥ÏΩò ÌÅ¥Î¶≠\n2. "ÏïåÎ¶º" ÏÑ§Ï†ïÏóêÏÑú "ÌóàÏö©" ÏÑ†ÌÉù\n3. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏÑ∏Ïöî.');
                    return false;
                }
                
                // Í∂åÌïú ÏöîÏ≤≠Ïù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ÏóêÎßå ÏöîÏ≤≠ (ÏÇ¨Ïö©Ïûê Ï†úÏä§Ï≤òÍ∞Ä ÏûàÏùÑ ÎïåÎßå)
                if (permission === 'default' && requestPermission) {
                    permission = await Notification.requestPermission();
                }
                
                if (permission === 'granted') {
                    console.log('ÏïåÎ¶º Í∂åÌïúÏù¥ ÌóàÏö©ÎêòÏóàÏäµÎãàÎã§.');
                    
                    // Firebase Cloud Messaging Î™®Îìà import
                    const { getMessaging, getToken, onMessage } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js');
                    
                    // FCM ÌÜ†ÌÅ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                    const messaging = getMessaging();
                    
                    // Service Worker Îì±Î°ù ÌôïÏù∏
                    let serviceWorkerRegistration = null;
                    if ('serviceWorker' in navigator) {
                        try {
                            serviceWorkerRegistration = await navigator.serviceWorker.ready;
                            console.log('‚úÖ Service Worker Ï§ÄÎπÑ ÏôÑÎ£å');
                        } catch (error) {
                            console.error('Service Worker Ï§ÄÎπÑ Ïã§Ìå®:', error);
                        }
                    }
                    
                    const token = await getToken(messaging, {
                        vapidKey: 'BHtWcI-zBH7NzVa1o3AFdTA-5pdYmhIizHNNCHoVGPftbRMh5iuarq3-7uxHNDffF2Z67ZGFMC9lZBuE9SC0agk',
                        serviceWorkerRegistration: serviceWorkerRegistration
                    });
                    
                    if (token) {
                        console.log('‚úÖ FCM ÌÜ†ÌÅ∞ ÌöçÎìù:', token.substring(0, 20) + '...');
                        // ÌÜ†ÌÅ∞ÏùÑ Firebase DatabaseÏóê Ï†ÄÏû•
                        const userName = localStorage.getItem('bamboo_userName');
                        const userId = localStorage.getItem('bamboo_userId');
                        if (userName && userId) {
                            const tokenRef = ref(database, `users/${userId}/fcmToken`);
                            
                            // Í∏∞Ï°¥ ÌÜ†ÌÅ∞ ÌôïÏù∏
                            const existingToken = await get(tokenRef);
                            if (existingToken.exists() && existingToken.val() === token) {
                                console.log('‚úÖ FCM ÌÜ†ÌÅ∞Ïù¥ Ïù¥ÎØ∏ Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.');
                                return;
                            }
                            
                            await set(tokenRef, token);
                            console.log('üíæ FCM ÌÜ†ÌÅ∞ Ï†ÄÏû• ÏãúÎèÑ ÏôÑÎ£å');
                            
                            // Ï†ÄÏû• ÌôïÏù∏ (Ïû¨ÏãúÎèÑ Ìè¨Ìï®)
                            let retries = 3;
                            while (retries > 0) {
                                await new Promise(resolve => setTimeout(resolve, 500));
                                const savedToken = await get(tokenRef);
                                if (savedToken.exists() && savedToken.val() === token) {
                                    console.log('‚úÖ FCM ÌÜ†ÌÅ∞ Ï†ÄÏû• ÌôïÏù∏ ÏôÑÎ£å');
                                    console.log('üì± Ï†ÑÏ≤¥ ÌÜ†ÌÅ∞:', token);
                                    return;
                                }
                                retries--;
                            }
                            console.error('‚ùå FCM ÌÜ†ÌÅ∞ Ï†ÄÏû• ÌôïÏù∏ Ïã§Ìå® - Ï†ÄÏû•Îêú Í∞íÏù¥ Îã§Î¶ÖÎãàÎã§.');
                        } else {
                            console.warn('‚ö†Ô∏è ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Í∞Ä ÏóÜÏñ¥ FCM ÌÜ†ÌÅ∞ÏùÑ Ï†ÄÏû•Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                            console.log('userId:', userId, 'userName:', userName);
                        }
                    } else {
                        console.error('‚ùå FCM ÌÜ†ÌÅ∞ÏùÑ Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                        console.log('ÏïåÎ¶º Í∂åÌïú ÏÉÅÌÉú:', permission);
                        console.log('VAPID ÌÇ§ ÌôïÏù∏ ÌïÑÏöî');
                    }
                    
                    // Ìè¨Í∑∏ÎùºÏö¥Îìú Î©îÏãúÏßÄ ÏàòÏã†
                    onMessage(messaging, (payload) => {
                        console.log('Ìè¨Í∑∏ÎùºÏö¥Îìú Î©îÏãúÏßÄ ÏàòÏã†:', payload);
                        // ÏïåÎ¶º ÌëúÏãú
                        if (Notification.permission === 'granted') {
                            new Notification(payload.notification.title, {
                                body: payload.notification.body,
                                icon: payload.notification.icon || '/bamboo/icon-192.png'
                            });
                        }
                    });
                    
                    return true; // ÏÑ±Í≥µ
                } else if (permission === 'default') {
                    console.log('ÏïåÎ¶º Í∂åÌïúÏù¥ ÏïÑÏßÅ ÏöîÏ≤≠ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                    return false;
                } else {
                    console.log('ÏïåÎ¶º Í∂åÌïúÏù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§.');
                    return false;
                }
            } catch (error) {
                console.error('Ìë∏Ïãú ÏïåÎ¶º Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
                if (error.code === 'messaging/permission-blocked') {
                    alert('ÏïåÎ¶º Í∂åÌïúÏù¥ Ï∞®Îã®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.\n\nÎ∏åÎùºÏö∞Ï†Ä ÏÑ§Ï†ïÏóêÏÑú ÏïåÎ¶ºÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî:\n1. Ï£ºÏÜåÏ∞Ω ÏôºÏ™Ω ÏûêÎ¨ºÏá† ÏïÑÏù¥ÏΩò ÌÅ¥Î¶≠\n2. "ÏïåÎ¶º" ÏÑ§Ï†ïÏóêÏÑú "ÌóàÏö©" ÏÑ†ÌÉù\n3. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏÑ∏Ïöî.');
                }
                return false;
            }
        }
        
        // ÏïåÎ¶º Ï†ÑÏÜ° Ìï®Ïàò (Îã§Î•∏ ÏÇ¨Ïö©ÏûêÎì§ÏóêÍ≤å ÏïåÎ¶º Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•)
        async function sendNotificationToUsers(notificationData) {
            try {
                const userName = localStorage.getItem('bamboo_userName');
                const notificationsRef = ref(database, 'notifications');
                const newNotificationRef = push(notificationsRef);
                
                await set(newNotificationRef, {
                    ...notificationData,
                    author: userName,
                    createdAt: new Date().toISOString()
                });
            } catch (error) {
                console.error('ÏïåÎ¶º Ï†ÑÏÜ° Ïò§Î•ò:', error);
            }
        }
        
        // Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º Í∞êÏßÄ Î∞è ÌëúÏãú
        function setupNotificationListener() {
            const currentUserName = localStorage.getItem('bamboo_userName');
            if (!currentUserName) return;
            
            const notificationsRef = ref(database, 'notifications');
            let lastNotificationTime = Date.now();
            
            onValue(notificationsRef, (snapshot) => {
                if (!snapshot.exists()) return;
                
                const notifications = snapshot.val();
                const notificationsArray = Object.entries(notifications)
                    .map(([id, notif]) => ({ id, ...notif }))
                    .sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
                
                // ÏµúÏã† ÏïåÎ¶ºÎßå ÌôïÏù∏ (Î≥∏Ïù∏Ïù¥ ÏûëÏÑ±Ìïú Í≤ÉÏùÄ Ï†úÏô∏)
                notificationsArray.forEach(notif => {
                    const notifTime = new Date(notif.createdAt).getTime();
                    if (notifTime > lastNotificationTime && notif.author !== currentUserName) {
                        // Î°úÏª¨ ÏïåÎ¶º ÌëúÏãú
                        if (Notification.permission === 'granted') {
                            const notification = new Notification(notif.title, {
                                body: notif.body,
                                icon: '/bamboo/icon-192.png',
                                badge: '/bamboo/icon-192.png',
                                tag: notif.type,
                                data: {
                                    type: notif.type,
                                    tab: notif.tab,
                                    postId: notif.postId,
                                    eventId: notif.eventId
                                }
                            });
                            
                            // ÏïåÎ¶º ÌÅ¥Î¶≠ Ïãú Ìï¥Îãπ ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
                            notification.onclick = () => {
                                window.focus();
                                if (notif.type === 'post' && notif.tab) {
                                    switchTab(notif.tab);
                                } else if (notif.type === 'event') {
                                    switchTab('calendar');
                                }
                            };
                        }
                        lastNotificationTime = notifTime;
                    }
                });
            });
        }
        
        // Î°úÍ∑∏Ïù∏ ÌõÑ Ìë∏Ïãú ÏïåÎ¶º Ï¥àÍ∏∞Ìôî
        async function initNotifications(requestPermission = false) {
            const userId = localStorage.getItem('bamboo_userId');
            if (!userId) return;
            
            // ÏÇ¨Ïö©Ïûê ÏäπÏù∏ ÏÉÅÌÉú ÌôïÏù∏
            try {
                const userRef = ref(database, `users/${userId}`);
                const userSnapshot = await get(userRef);
                
                if (!userSnapshot.exists()) {
                    console.log('‚ö†Ô∏è ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                const user = userSnapshot.val();
                const isApproved = user.approved === true || userId === 'admin' || user.name === 'admin';
                
                // ÏäπÏù∏ÎêòÏßÄ ÏïäÏùÄ ÏÇ¨Ïö©ÏûêÎäî ÏïåÎ¶º Í∂åÌïú ÏöîÏ≤≠ÌïòÏßÄ ÏïäÏùå
                if (!isApproved) {
                    console.log('‚ÑπÔ∏è ÏäπÏù∏ÎêòÏßÄ ÏïäÏùÄ ÏÇ¨Ïö©ÏûêÏûÖÎãàÎã§. Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÌõÑ ÏïåÎ¶ºÏùÑ Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§.');
                    return;
                }
            } catch (error) {
                console.error('ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÌôïÏù∏ Ïò§Î•ò:', error);
                return;
            }
            
            // Í∂åÌïú ÏÉÅÌÉú ÌôïÏù∏
            const currentPermission = Notification.permission;
            
            // Í∂åÌïúÏù¥ Ï∞®Îã®Îêú Í≤ΩÏö∞
            if (currentPermission === 'denied') {
                console.log('‚ö†Ô∏è ÏïåÎ¶º Í∂åÌïúÏù¥ Ï∞®Îã®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§. Î∏åÎùºÏö∞Ï†Ä ÏÑ§Ï†ïÏóêÏÑú ÏïåÎ¶ºÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // FCM ÌÜ†ÌÅ∞Ïù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
            const tokenRef = ref(database, `users/${userId}/fcmToken`);
            const tokenSnapshot = await get(tokenRef);
            
            if (!tokenSnapshot.exists() || !tokenSnapshot.val()) {
                // ÏäπÏù∏Îêú ÏÇ¨Ïö©ÏûêÎäî ÏûêÎèôÏúºÎ°ú ÏïåÎ¶º Í∂åÌïú ÏöîÏ≤≠
                if (currentPermission === 'granted') {
                    console.log('üîÑ FCM ÌÜ†ÌÅ∞Ïù¥ ÏóÜÏñ¥ÏÑú Îã§Ïãú Ï¥àÍ∏∞ÌôîÌï©ÎãàÎã§...');
                    await initializePushNotifications(false);
                } else if (currentPermission === 'default') {
                    // Í∂åÌïúÏù¥ ÏïÑÏßÅ ÏöîÏ≤≠ÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞ ÏûêÎèôÏúºÎ°ú ÏöîÏ≤≠
                    console.log('üîî ÏäπÏù∏Îêú ÏÇ¨Ïö©Ïûê - ÏïåÎ¶º Í∂åÌïúÏùÑ ÏûêÎèôÏúºÎ°ú ÏöîÏ≤≠Ìï©ÎãàÎã§...');
                    await initializePushNotifications(true);
                }
            } else {
                console.log('‚úÖ FCM ÌÜ†ÌÅ∞Ïù¥ Ïù¥ÎØ∏ Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.');
            }
            
            setupNotificationListener();
        }
        
        // PWA ÏÑ§Ïπò Ïù¥Î≤§Ìä∏ Í∞êÏßÄ
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('üì± PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏ Ï§ÄÎπÑÎê®');
        });
        
        // PWA ÏÑ§Ïπò ÏôÑÎ£å Ïù¥Î≤§Ìä∏
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA ÏÑ§Ïπò ÏôÑÎ£å - ÏïåÎ¶º Í∂åÌïú ÏûêÎèô ÏöîÏ≤≠');
            deferredPrompt = null;
            // ÏÑ§Ïπò ÌõÑ ÏûêÎèôÏúºÎ°ú ÏïåÎ¶º Í∂åÌïú ÏöîÏ≤≠
            setTimeout(() => {
                initNotifications(true);
            }, 1000);
        });
        
        // ÏäπÏù∏ ÏÉÅÌÉú Î≥ÄÍ≤Ω Í∞êÏßÄ
        const userId = localStorage.getItem('bamboo_userId');
        if (userId) {
            const userRef = ref(database, `users/${userId}/approved`);
            onValue(userRef, async (snapshot) => {
                if (snapshot.exists() && snapshot.val() === true) {
                    console.log('‚úÖ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏäπÏù∏ÎêòÏóàÏäµÎãàÎã§ - ÏïåÎ¶º Í∂åÌïú ÏûêÎèô ÏöîÏ≤≠');
                    // ÏäπÏù∏Îêú ÏßÅÌõÑ ÏûêÎèôÏúºÎ°ú ÏïåÎ¶º Í∂åÌïú ÏöîÏ≤≠
                    await initNotifications(true);
                }
            });
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏûêÎèôÏúºÎ°ú ÏïåÎ¶º Ï¥àÍ∏∞Ìôî (ÏäπÏù∏Îêú ÏÇ¨Ïö©ÏûêÎßå)
        if (Notification.permission === 'granted') {
            // Í∂åÌïúÏù¥ Ïù¥ÎØ∏ ÌóàÏö©Îêú Í≤ΩÏö∞ ÏûêÎèô Ï¥àÍ∏∞Ìôî
            initNotifications(false);
        } else {
            // Í∂åÌïúÏù¥ ÏóÜÎäî Í≤ΩÏö∞ÏóêÎèÑ ÏäπÏù∏Îêú ÏÇ¨Ïö©ÏûêÎ©¥ ÏûêÎèô ÏöîÏ≤≠
            initNotifications(true);
        }
        
    </script>
</body>
</html>